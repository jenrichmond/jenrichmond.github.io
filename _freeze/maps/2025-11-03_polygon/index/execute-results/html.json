{
  "hash": "1982f096945689f7d79af59cc2b153cd",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Day 3: polygon\"\nauthor: Jen Richmond\ndate: 2025-11-03\nformat: html\neditor: source\ndraft: FALSE\nimage: pop.png\nexecute:\n  freeze: true\n---\n\n\nDay 3 of the challenge is polygons, so I wanted to work out how make a map that splits NZ into regions and fills the area of each by population. The `spData` package was a good find because it contains data about land area, population, and median income data by region. The population data was a bit out of date so here I have found 2024 estimates from StatsNZ and joined the updated population data. \n\n![](pop.png)\n\n# get data\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(tidyverse)\nlibrary(here)\nlibrary(sf)\nlibrary(spData) # has nz map/data\nlibrary(janitor)\nlibrary(scales)\n\nnz <- nz \n\nnz_regions <- nz %>%\n  select(Name, geom)\n\n\n# Stats NZ subnational population estimates (RC, constituency), by age and sex, at 30 June 2023-24 (2023 boundaries)\n# clean to get more recent data, remove totals, name variable names match nz df so that join works\n\npop <- read_csv(here(\"maps\", \"2025-11-03_polygon\", \"statsNZ_pop_region.csv\")) %>%\n  clean_names() \n\npop_total <- pop %>%\n  filter(area == \"Total New Zealand by regional councils\") %>%\n  filter(year_at_30_june == 2024)\n\ntotalNZpop24 <- pop_total$obs_value\n\npop_region <- pop %>%\n  filter(year_at_30_june == 2024) %>%\n  filter(area != \"Total New Zealand by regional councils\") %>%\n  select(Name = area, Population24 = obs_value) %>%\n  mutate(Name = str_remove(Name, \"region\")) %>%\n  mutate(Name = str_trim(Name)) %>%\n  mutate(Name =  str_replace_all(Name, \"Å«\", \"u\")) %>% \n  mutate(Name =  str_replace_all(Name, \"Wh\", \"W\"))\n\n\n# note: when joining always put the sf dataframe first, so that it keeps geom info\n\nnzpop24 <- left_join(nz, pop_region, by = \"Name\") %>%\n  rowwise() %>%\n  mutate(proportion = (Population24/totalNZpop24)*100)\n\nnorthsouth <- nzpop24 %>%\n  group_by(Island) %>%\n  summarise(pop = sum(proportion))\n```\n:::\n\n\n## plot\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nggplot(data = nz) +\n  geom_sf(aes(fill = Name), color = \"black\") + \n  labs(title = \"Map of New Zealand Regions\", fill = \"Region Name\") +\n  theme_bw() \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code  code-fold=\"true\"}\nggplot(data = nzpop24) +\n  geom_sf(aes(fill = Population24), color = \"black\") + # Fill by region name and add black borders\n  labs(title = \"The Team of 5 million\", fill = \"Population\", \n       subtitle = \"StatsNZ estimates that 5.3 million people live in New Zealand. \\nOne third of Kiwis live in Auckland. \\nMore than 75% of Kiwis live in the North Island.\", \n       caption = \"Data from StatsNZ Dec 2024\") +\n  scale_fill_gradient(low = \"lightblue\", high = \"darkblue\", \n                      labels = label_number(scale = 1e-6, suffix = \"M\")) +\n  theme_bw() \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n:::\n\n\n\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}