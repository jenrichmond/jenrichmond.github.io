{
  "hash": "e0a6cf5b9ef40af4493f5b9ceff4e01d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Day 2: lines\"\nauthor: Jen Richmond\ndate: 2025-11-02\nformat: html\neditor: source\ndraft: FALSE\nimage: ta.png\nexecute:\n  freeze: true\n---\n\nSticking to the theme of walking trails in NZ, for Day 2 of the #30DayMapChallenge I am plotting the route of the Te Araroa Trail, a 3000km track that goes from the top of the North Island to the bottom of the South Island. My first foray into plotting .gpx data, downloaded from the [Te Araroa Trail map site](https://www.teararoa.org.nz/trail-maps/).\n\n[![Route and elevation of the Te Araroa trail. ](ta.png)](https://www.teararoa.org.nz/trail-maps/)\n\n## read data\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(rnaturalearth)\nlibrary(here)\nlibrary(naniar)\nlibrary(ggannotate)\nlibrary(ggeasy)\n\n# Get NZ map\nnz <- ne_countries(country = \"new zealand\", returnclass = \"sf\", scale = \"large\")\n\n# Load your trail data \n\ntrail <- st_read(here(\"maps\", \"2025-11-02_lines\", \"gpx_data\", \"TeAraroaTrail_2025_26.gpx\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMultiple layers are present in data source /Users/jenrichmond/Dropbox/ALL_R_stuff/2. WEBSITES/jenrichmond.github.io/maps/2025-11-02_lines/gpx_data/TeAraroaTrail_2025_26.gpx, reading layer `waypoints'.\nUse `st_layers' to list all layer names and their type in a data source.\nSet the `layer' argument in `st_read' to read a particular layer.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `waypoints' from data source \n  `/Users/jenrichmond/Dropbox/ALL_R_stuff/2. WEBSITES/jenrichmond.github.io/maps/2025-11-02_lines/gpx_data/TeAraroaTrail_2025_26.gpx' \n  using driver `GPX'\nSimple feature collection with 3058 features and 23 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 167.7707 ymin: -46.62184 xmax: 175.6654 ymax: -34.4267\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\n## explore data\n\nThis is my first time reading .gpx data into R and it looks like a WHOLE LOT of NAs. It is possible that there is useful information in some of these variables, and `naniar::vis_miss()` is a good way to check. It seems that only the name variable and the geometry variable have any data at all, so I am going to select just those.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nglimpse(trail)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 3,058\nColumns: 24\n$ ele           <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ time          <dttm> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ magvar        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ geoidheight   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ name          <chr> \"0 km\", \"1 km\", \"2 km\", \"3 km\", \"4 km\", \"5 km\", \"6 km\", …\n$ cmt           <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ desc          <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ src           <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ link1_href    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ link1_text    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ link1_type    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ link2_href    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ link2_text    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ link2_type    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ sym           <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ type          <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ fix           <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ sat           <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ hdop          <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ vdop          <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ pdop          <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ ageofdgpsdata <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ dgpsid        <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ geometry      <POINT [°]> POINT (172.6776 -34.4267), POINT (172.6774 -34.433…\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\"}\nvis_miss(trail)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code  code-fold=\"true\"}\nta <- trail %>%\n  select(name, geometry)\n```\n:::\n\n\n## plot trail\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nggplot() +\n  geom_sf(data = nz, fill = \"lightgray\", color = \"white\") +\n  geom_sf(data = ta, color = \"skyblue4\", size = 0.2)  +\n  coord_sf(xlim = c(166, 179), ylim = c(-47, -34)) +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## plot sections\n\nThe whole trail gpx file doesn't have elevation data, so I have downloaded all the files for each trail section and I am reading them all into into single dataframe, pulling section number and name out of filename. There are also parts of the route that through hikers typically bypass to avoid dangerous rivers or sections of road that are not worth walking, so I am filtering out those bypass sections too.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ngpx_files <- list.files(here(\"maps\", \"2025-11-02_lines\", \"gpx_data\", \"routes\"), \n                        pattern = \"\\\\.gpx$\", \n                        full.names = TRUE)\n\nall_routes <- gpx_files %>%\n  set_names(basename(gpx_files)) %>% # use filename as names \n  map_dfr(\n    ~st_read(.x, layer = \"track_points\", quiet = TRUE), \n    .id = \"filename\"\n  ) %>%\n  mutate(route_section = tools::file_path_sans_ext(filename)) %>%\n  mutate(route_number = parse_number(route_section)) %>%\n  select(route_number, route_section, track_seg_point_id, ele, geometry) %>%\n  mutate(bypass = str_detect(route_section, \"Bypass\")) \n\nta_trail <- all_routes %>%\n  filter(bypass == FALSE)\n\n\n\nmap <- ggplot() +\n  geom_sf(data = nz, fill = \"lightgray\", color = \"white\") +\n  geom_sf(data = ta_trail, aes(color = ele), size = 0.2) +\n  scale_color_viridis_c(option = \"plasma\", name = \"Elevation (m)\", \n                        limits = c(0, 2000), breaks = seq(0, 2000, by = 500)) +\n  coord_sf(xlim = c(165, 180), ylim = c(-47, -34)) +\n  theme_bw() +\n  labs(title = \"Te Araroa Trail New Zealand\", subtitle = \"The TA trail is a 3000 km walking track that goes from Cape Reinga \\nat the top of the North Island to Bluff at the bottom of the South Island. \\nIt typically takes hikers 4-6 months to complete. Hikers reach the highest \\npoint in the North Island at 1861m above sea level while walking the \\nTongariro Alpine Crossing. In the South Island, the highest point on the trail \\nis on the Two Thumb Track near Lake Tekapo at 1934m above sea level.\") +\n  geom_text(data = data.frame(x = 173.5, y = -45, label = \"Two Thumb Track: \\nStag Saddle 1934m\"),\n          mapping = aes(x = x, y = y, label = label),\n          size = 2.65, inherit.aes = FALSE) +\n  geom_text(data = data.frame(x = 178.2, y = -40.5, label = \"Tongaririo \\nAlpine Crossing: \\nRed Crater 1861m\"),\n          mapping = aes(x = x, y = y, label = label),\n        size = 2.65, inherit.aes = FALSE) +\n  geom_segment(aes(x = 172, y = -45, xend = 171, yend = -44),\n    arrow = arrow(length = unit(0.1, \"cm\"), type = \"closed\"),\n    color = \"blue\",\n    linewidth  = 1\n  ) +\n  geom_segment(aes(x = 178, y = -39.8, xend = 176, yend = -39.2),\n    arrow = arrow(length = unit(0.1, \"cm\"), type = \"closed\"),\n    color = \"blue\",\n    linewidth  = 1\n  ) +\n  easy_remove_axes(which = c(\"both\"), what = c(\"title\"))\n```\n:::\n\n\n\n\n![](ta.png)\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}