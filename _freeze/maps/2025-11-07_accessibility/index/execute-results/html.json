{
  "hash": "8f1728bdd01430319c266362acbb5f2e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Day 7: accessibility\"\nauthor: Jen Richmond\ndate: 2025-11-07\nformat: html\neditor: source\ndraft: FALSE\nimage: featured.png\nexecute:\n  freeze: true\n---\n\nI am interested in the accessibility of public libraries. \n\nHere I worked out how to plot library locations on a map that also included regional information. The map below does make me question how complete the [Directory of New Zealand libraries](https://natlib.govt.nz/librarians/directory-of-new-zealand-libraries) is though. Surely there is more than 1 library in Auckland! \n\n![](lib.png)\n\n# load packages\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(tidyverse)\nlibrary(here)\nlibrary(janitor)\nlibrary(tidygeocoder)\nlibrary(spData)\nlibrary(sf)\n```\n:::\n\n\n# get data\n\nThe `geocode()` function is amazing at turning address data into lat/long data but SLOW when it is looking for more than a handful of coordinates, so here I am writing the data to csv in order to read it back in. \n\nTried method = \"osm\" first (OpenStreetMap) and it missed coordinates for 23 sites. Turns out that method = \"arcgis\" works better. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ncities <- c(\"Auckland\", \"Hamilton\", \"Wellington\", \"Christchurch\", \"Dunedin\")\n\nlibraries <- read_csv(\"maps/2025-11-07_accessibility/directory-of-new-zealand-libraries.csv\") %>%\n  clean_names() %>%\n   mutate(city = str_extract(street_address, paste(cities, collapse = \"|\"))) %>%\nselect(library_type_3, name, street_address, city) \n\n\npublic <- libraries %>%\n  filter(library_type_3 == \"Public\") %>%\n  geocode(street_address, method = 'arcgis', lat = latitude , long = longitude) \n\n\npublic %>% \n  filter(library_type_3 == \"Public\") %>%\n  write_csv(here(\"maps\", \"2025-11-07_accessibility\", \"public.csv\"))\n```\n:::\n\n\n# plot1 \n\nIf you want to make a map without regional information using the rnaturalearth package works well. \n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlib <- read_csv(here(\"maps\", \"2025-11-07_accessibility\", \"public.csv\")) \n\nrne_nz <- rnaturalearth::ne_countries(country = \"new zealand\", returnclass = \"sf\", scale = \"large\")\n\n\nggplot() +\n  geom_sf(data = rne_nz) +\n  geom_point(data = lib, aes(x = longitude, y = latitude)) +\n  coord_sf(xlim = c(166, 179), ylim = c(-47, -34)) +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n# plot2\n\nBut if you want regional information on your plot, you need to battle wih spData. Here I ran into problems that required converting the nz map to lat/long and then converting point locations to sf. \n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# nz map with areas from spData \n\nnz <- nz\n\nsp_nz <- st_transform(nz, 4326)  # Convert nz to lat/long\n\n# convert points to sf geometry\n\nlib_sf <- st_as_sf(lib, coords = c(\"longitude\", \"latitude\"), crs = 4326)\n\nggplot() +\n  geom_sf(data = sp_nz, fill = \"lightgrey\", color = \"darkgrey\") +\n  geom_sf(data = lib_sf, color = \"red\", size = 2) +\n  coord_sf(xlim = c(166, 179), ylim = c(-47, -34)) +\n  theme_bw() +\n  labs(title = \"Where is the nearest public library?\", caption= \"Data from https://natlib.govt.nz/librarians/directory-of-new-zealand-libraries\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}