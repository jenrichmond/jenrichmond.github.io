{
  "hash": "d7c1d3a8bd680f49348a2be38ace55a2",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lead levels in Flint water\"\nsubtitle: \"Tidy Tuesday Week 44\"\nauthor: \"Jen Richmond\"\ndate: 2025-11-04\nformat: html\nimage: featured.png\ncode-fold: true\n---\n\nThe TidyTuesday data this week is from a paper by [Loux & Gibson (2018)](https://onlinelibrary.wiley.com/doi/abs/10.1111/test.12187?casa_token=av3lP7OmqS0AAAAA%3AQAF3yU5kGzsUkqi1VlXkMlIN8ExolHZBSkdJ3hIHnlptUES57dGVoXjE3qdwPPHtLHNRd9VvX1x8f6VN) about using lead data from Flint Michigan as a example for introductory statistics. When I was curating the data, I wanted to use [the figure](https://academic.oup.com/view-large/figure/395148782/sign_14_2_16_fig-1.png) from [this blog post](https://academic.oup.com/jrssig/article/14/2/16/7029247?login=false) about the murky tale of Flint's water data, but the image wouldn't download well, so here is how I recreated it using ggplot. \n\n![](Flint_lead.png)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidytuesdayR)\nlibrary(ggeasy)\nlibrary(ggannotate)\n  \ntuesdata <- tidytuesdayR::tt_load(2025, week = 44)\n\nflint_mdeq <- tuesdata[[1]]\nflint_vt <- tuesdata[[2]]\n\nrm(tuesdata)\n```\n:::\n\n\n\n## calculating 90th percentiles\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  flint_mdeq %>%\n    summarise(\n      p90lead = quantile(lead, 0.90),\n      p90lead2 = quantile(lead2, 0.90, na.rm= TRUE)) %>%\n  gt::gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"khozbqpdln\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#khozbqpdln table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#khozbqpdln thead, #khozbqpdln tbody, #khozbqpdln tfoot, #khozbqpdln tr, #khozbqpdln td, #khozbqpdln th {\n  border-style: none;\n}\n\n#khozbqpdln p {\n  margin: 0;\n  padding: 0;\n}\n\n#khozbqpdln .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#khozbqpdln .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#khozbqpdln .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#khozbqpdln .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#khozbqpdln .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#khozbqpdln .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#khozbqpdln .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#khozbqpdln .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#khozbqpdln .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#khozbqpdln .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#khozbqpdln .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#khozbqpdln .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#khozbqpdln .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#khozbqpdln .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#khozbqpdln .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#khozbqpdln .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#khozbqpdln .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#khozbqpdln .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#khozbqpdln .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#khozbqpdln .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#khozbqpdln .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#khozbqpdln .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#khozbqpdln .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#khozbqpdln .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#khozbqpdln .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#khozbqpdln .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#khozbqpdln .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#khozbqpdln .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#khozbqpdln .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#khozbqpdln .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#khozbqpdln .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#khozbqpdln .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#khozbqpdln .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#khozbqpdln .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#khozbqpdln .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#khozbqpdln .gt_left {\n  text-align: left;\n}\n\n#khozbqpdln .gt_center {\n  text-align: center;\n}\n\n#khozbqpdln .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#khozbqpdln .gt_font_normal {\n  font-weight: normal;\n}\n\n#khozbqpdln .gt_font_bold {\n  font-weight: bold;\n}\n\n#khozbqpdln .gt_font_italic {\n  font-style: italic;\n}\n\n#khozbqpdln .gt_super {\n  font-size: 65%;\n}\n\n#khozbqpdln .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#khozbqpdln .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#khozbqpdln .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#khozbqpdln .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#khozbqpdln .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#khozbqpdln .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#khozbqpdln .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#khozbqpdln .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#khozbqpdln div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"p90lead\">p90lead</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"p90lead2\">p90lead2</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"p90lead\" class=\"gt_row gt_right\">18</td>\n<td headers=\"p90lead2\" class=\"gt_row gt_right\">11.4</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\n\n# add new variable\n\nThe plot colours samples that were removed red and those where lead was non detectable (i.e. 0) white. In order to fill the histogram bars in this way, here I am creating a new variable which categorises each sample as removed, kept or ND. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n  flint_mdeq <- flint_mdeq %>%\n    mutate(removed = case_when(lead == 104 & is.na(lead2) ~ \"remove\",\n                             lead == 20 & is.na(lead2) ~ \"remove\",\n                             lead == 0 ~ \"ND\", \n                             TRUE ~ \"keep\"  # keeps existing values for other rows\n    ))\n```\n:::\n\n\n\n# plot \n\n\n::: {.cell}\n\n```{.r .cell-code}\n  pal <- c(\"grey\", \"white\", \"red\")\n  \n  flint_mdeq %>%\n    ggplot(aes(x = lead, fill = removed)) +\n    geom_vline(xintercept = seq(0, 100, by = 25), \n               colour = \"white\", \n               linewidth = 0.5) + \n    geom_hline(yintercept = seq(0, 12.5, by = 2.5),  # Adjust the range and interval as needed\n               colour = \"white\", \n               linewidth = 0.5) +\n    geom_histogram(binwidth = 1, colour = \"grey20\") +\n    labs(y = \"Number of samples\", \n         x = \"Lead (parts per billion), ND = not detectable\") +\n    scale_x_continuous(\n      breaks = c(0, 5, 10, 15, 20, 25, 50, 75, 100),\n      labels = c(\"ND\", \"5\", \"10\", \"15\", \"20\", \"25\", \"50\", \"75\", \"100\")) +\n    scale_y_continuous(\n      breaks = c(0, 1, 2, 3, 4, 5, 10)) +\n    scale_fill_manual(values = pal) +\n    easy_remove_gridlines() +\n    easy_remove_legend() +\n    geom_segment(aes(x = 12, xend = 12, y = 0, yend = 12), \n               colour = \"deepskyblue3\", \n               linetype = \"dashed\") +\n    geom_text(data = data.frame(x = 14, y = 13, label = \"11.4 ppb\"),\n              mapping = aes(x = x, y = y, label = label),\n              size = 4, hjust = 0, colour = \"deepskyblue3\",, family = \"\", inherit.aes = FALSE) +\n    geom_text(data = data.frame(x = 14, y = 11.9, label = \"Flint's 90th percentile \\nvalue after two \\nsamples were excluded\"),\n              mapping = aes(x = x, y = y, label = label),\n              size = 2, hjust = 0, colour = \"deepskyblue3\", family = \"\", inherit.aes = FALSE) +\n    geom_segment(aes(x = 15, xend = 15, y = 0, yend = 10), \n                 colour = \"grey20\", \n                 linetype = \"dashed\") +\n    geom_text(data = data.frame(x = 17, y = 10, label = \"15 ppb\"),\n              mapping = aes(x = x, y = y, label = label),\n              size = 4, hjust = 0, colour = \"grey20\", family = \"\", inherit.aes = FALSE) +\n    geom_text(data = data.frame(x = 17, y = 9.4, label = \"Lead `action` level\"),\n              mapping = aes(x = x, y = y, label = label),\n              size = 2, hjust = 0, colour = \"grey20\", family = \"\", inherit.aes = FALSE) +\n    geom_segment(aes(x = 19, xend = 19, y = 0, yend = 9), \n                 colour = \"red\", \n                 linetype = \"dashed\") +\n  geom_text(data = data.frame(x = 22, y = 8, label = \"18 ppb\"),\n            mapping = aes(x = x, y = y, label = label),\n            size = 4, hjust = 0,  colour = \"red\", family = \"\", inherit.aes = FALSE) +\n    geom_text(data = data.frame(x = 22, y = 6.9, label = \"Flint's 90th percentile \\nvalue before two \\nsamples were excluded\"),\n              mapping = aes(x = x, y = y, label = label),\n              size = 2, hjust = 0, colour = \"red\", family = \"\", inherit.aes = FALSE) +\n    theme(axis.text.x = element_text(size = 6),\n          axis.text.y = element_text(size = 6),\n          axis.title.x = element_text(size = 8, face = \"bold\"),\n          axis.title.y = element_text(size = 8, face = \"bold\"))  +\n    geom_label(data = data.frame(x = 52, y = 8, \n                                label = str_wrap(\"FIGURE 1 Lead levels in water samples collected by Flint city officials, covering the period January to June 2015. As per the Lead and Copper Rule, if more than 10% of samples, or the 90th percentile value, are above 15 ppb, officials are required to take action. In total, 71 samples were collected with a 90th percentile value of 18 ppb. However, 2 samples, shown in red, were excluded- one with a lead concentration of 20 ppb, the other 104 ppb. The remaining 69 samples had a 90th percentile value of lead concentration of 11.4 ppb.\", \n                                                 width = 60)),\n              mapping = aes(x = x, y = y, label = label),\n              size = 2,  fill = \"grey92\", hjust = 0, family = \"\", inherit.aes = FALSE)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}