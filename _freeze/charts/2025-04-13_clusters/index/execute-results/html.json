{
  "hash": "ba23c3ad3fc65e7c8b1c7a38432c2b37",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"day 13_clusters\"\nauthor:\n  - name: Jen Richmond\n    url: https://jenrichmond.github.io/\ndate: 2025-04-13\nformat: html\neditor: source\nimage: featured.png\nexecute:\n  freeze: true\n---\n\n\n\n\nToday I am again departing from Our World in Data to play around with something I know nothing about: k-means clustering. This animation by Allison Horst from the  [`tidymodels` documentation](https://www.tidymodels.org/learn/statistics/k-means/) is super cute and explains what k-means clustering does. \n\n![Art by Allison Horst](https://www.tidymodels.org/learn/statistics/k-means/kmeans.gif)\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(palmerpenguins)\nlibrary(factoextra)\nlibrary(janitor)\nlibrary(gt)\n\nset.seed(123)\n```\n:::\n\n\n\n\n\nhttps://www.tidymodels.org/learn/statistics/k-means/\n\nThe penguins data from the `palmerpenguins` package seemed like a good place to start. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#read the dataset\npenguins <- penguins %>%\n  na.omit()\n\n# pull just species for later\nspecies <- penguins %>%\n  select(species)\n```\n:::\n\n\n\n\n\n# Body mass x bill length\n\nI am interested in whether we can cluster the penguins using information about their body mass and bill length. Here I am selecting just those variables, scaling the data and then using the `kmeans` function to compute 3 clusters. The output shows which cluster the model has assigned each data point to and tells us that this cluster arrangement accounts for 73% of the variance. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# select a subset of the variables\nbodymass_bill <- penguins %>%\n  select(body_mass_g, bill_length_mm) \n\n# scale the data\nbodymass_bill_scaled <- scale(bodymass_bill) \n\n# compute 3 clusters\nkm_bodymass_bill <- kmeans(bodymass_bill_scaled, centers = 3)\n\n\nkm_bodymass_bill\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nK-means clustering with 3 clusters of sizes 106, 148, 79\n\nCluster means:\n  body_mass_g bill_length_mm\n1   1.2331389      0.7262020\n2  -0.6697839     -0.9559782\n3  -0.3998065      0.8165489\n\nClustering vector:\n  [1] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2\n [38] 2 3 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 2 2 2 2 2 2\n [75] 2 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 1 2 1 2 2 2 2 2\n[112] 2 2 2 2 2 2 2 2 2 2 2 2 3 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 1\n[149] 3 1 1 1 1 1 3 1 2 1 1 1 3 1 2 1 1 1 1 1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1\n[186] 2 1 3 1 1 1 3 1 1 1 1 1 3 1 1 1 3 1 3 1 3 1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1\n[223] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1\n[260] 1 1 1 1 1 1 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 2 3 2 3 3 3 3 3 3 3 2\n[297] 3 2 3 3 3 3 1 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 2 3 3 3 3 3 3 3 3 3 2 3 3 3\n\nWithin cluster sum of squares by cluster:\n[1] 62.12498 74.59241 43.24261\n (between_SS / total_SS =  72.9 %)\n\nAvailable components:\n\n[1] \"cluster\"      \"centers\"      \"totss\"        \"withinss\"     \"tot.withinss\"\n[6] \"betweenss\"    \"size\"         \"iter\"         \"ifault\"      \n```\n\n\n:::\n:::\n\n\n\n\n\n### plot\n\nTo visualise the clusters I am using the `fviz_cluster()` function from the `factoextra` package. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_cluster(km_bodymass_bill, data = bodymass_bill, \n             show.clust.cent = FALSE, label=NA) +\n  theme_bw() +\n  labs(title = \"Cluster plot k-means penguin classification\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\nWell that was almost too easy. Those clusters look nice but I know that the model isn't 100% accurate. Which points have been misclassified?\n\nHere I am using `augment()` from `tidymodels` to add the cluster information to the original data, and then joining the species vector onto that dataframe, so that I end up with a joined dataframe that includes information about species, body mass, bill length and the cluster values.  Then I mutate a new variable that codes whether each data point was correctly classified or not. \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# use augment to add clusters to original data\nclusters <- augment(km_bodymass_bill, bodymass_bill)\n\n# add species column to clusters\njoined <- bind_cols(species, clusters) %>%\n  rename(cluster = .cluster) %>%\n  mutate(correct = case_when(species == \"Adelie\" & cluster == 2 ~ \"TRUE\", \n                             species == \"Gentoo\" & cluster == 1 ~ \"TRUE\", \n                             species == \"Chinstrap\" & cluster == 3 ~ \"TRUE\", \n                             TRUE ~ \"FALSE\"))\n```\n:::\n\n\n\n\nThen I am using `tabyl` from janitor to count the misclassifications by species and plotting by species and classification accuracy. \n\nThis shows that most of the Adelie and Chinstrap penguins are grouped into the same cluster but some of the smaller Gentoo penguins seem to have been misclassified. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\njoined %>%\n  tabyl(species,correct) %>%\n  gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"jrvketnvyz\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#jrvketnvyz table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#jrvketnvyz thead, #jrvketnvyz tbody, #jrvketnvyz tfoot, #jrvketnvyz tr, #jrvketnvyz td, #jrvketnvyz th {\n  border-style: none;\n}\n\n#jrvketnvyz p {\n  margin: 0;\n  padding: 0;\n}\n\n#jrvketnvyz .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#jrvketnvyz .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#jrvketnvyz .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#jrvketnvyz .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#jrvketnvyz .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#jrvketnvyz .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#jrvketnvyz .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#jrvketnvyz .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#jrvketnvyz .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#jrvketnvyz .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#jrvketnvyz .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#jrvketnvyz .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#jrvketnvyz .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#jrvketnvyz .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#jrvketnvyz .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#jrvketnvyz .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#jrvketnvyz .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#jrvketnvyz .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#jrvketnvyz .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#jrvketnvyz .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#jrvketnvyz .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#jrvketnvyz .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#jrvketnvyz .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#jrvketnvyz .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#jrvketnvyz .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#jrvketnvyz .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#jrvketnvyz .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#jrvketnvyz .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#jrvketnvyz .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#jrvketnvyz .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#jrvketnvyz .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#jrvketnvyz .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#jrvketnvyz .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#jrvketnvyz .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#jrvketnvyz .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#jrvketnvyz .gt_left {\n  text-align: left;\n}\n\n#jrvketnvyz .gt_center {\n  text-align: center;\n}\n\n#jrvketnvyz .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#jrvketnvyz .gt_font_normal {\n  font-weight: normal;\n}\n\n#jrvketnvyz .gt_font_bold {\n  font-weight: bold;\n}\n\n#jrvketnvyz .gt_font_italic {\n  font-style: italic;\n}\n\n#jrvketnvyz .gt_super {\n  font-size: 65%;\n}\n\n#jrvketnvyz .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#jrvketnvyz .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#jrvketnvyz .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#jrvketnvyz .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#jrvketnvyz .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#jrvketnvyz .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#jrvketnvyz .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#jrvketnvyz .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#jrvketnvyz div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"species\">species</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"FALSE\">FALSE</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"TRUE\">TRUE</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"species\" class=\"gt_row gt_center\">Adelie</td>\n<td headers=\"FALSE\" class=\"gt_row gt_right\">7</td>\n<td headers=\"TRUE\" class=\"gt_row gt_right\">139</td></tr>\n    <tr><td headers=\"species\" class=\"gt_row gt_center\">Chinstrap</td>\n<td headers=\"FALSE\" class=\"gt_row gt_right\">7</td>\n<td headers=\"TRUE\" class=\"gt_row gt_right\">61</td></tr>\n    <tr><td headers=\"species\" class=\"gt_row gt_center\">Gentoo</td>\n<td headers=\"FALSE\" class=\"gt_row gt_right\">17</td>\n<td headers=\"TRUE\" class=\"gt_row gt_right\">102</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n\n```{.r .cell-code}\njoined %>%\n  ggplot(aes(x = body_mass_g, y = bill_length_mm, colour = species, shape = correct)) +\n  geom_point(size = 2) +\n  theme_bw() +\n  scale_shape_manual(values=c(4, 1))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}