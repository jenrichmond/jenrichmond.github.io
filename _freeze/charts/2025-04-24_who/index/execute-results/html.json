{
  "hash": "4f69034b276b9bb43646bdb87977666e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"day 24 WHO\"\nauthor:\n  - name: Jen Richmond\n    url: https://jenrichmond.github.io/\ndate: 2025-04-24\nformat: html\neditor: source\nimage: featured.png\nexecute:\n  freeze: true\n---\n\n\n\n\nThe prompt for Day 24 is the World Health Organisation. I spent some time exploring the WHO website for a chart that uses a geom that I hadn't tried before and came up with this one from the [World Health Statistics 2024 report](https://www.who.int/publications/i/item/9789240094703). \n\n![](hepBHepC_who_report2024_p37.png)\n\nI found a table of the data in the [Global Hepatitis Report 2024](https://www.who.int/publications/i/item/9789240091672) and used this [Rscript](https://github.com/jenrichmond/jenrichmond.github.io/blob/main/charts/2025-04-24_who/get_hep_data.R) to get it into csv format. \n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\nlibrary(janitor)\nlibrary(treemapify)\nlibrary(ggeasy)\nlibrary(patchwork)\nlibrary(ggtext)\n\nhep <- read_csv(here(\"charts\", \"2025-04-24_who\", \"hepBC.csv\"))\n\nglimpse(hep)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 6\nColumns: 5\n$ WHO_region  <chr> \"African Region\", \"Region of the Americas\", \"South-East Asâ€¦\n$ new_hepB    <dbl> 771000, 8000, 266000, 18000, 86000, 83000\n$ new_hepC    <dbl> 172000, 176000, 225000, 126000, 183000, 98000\n$ deaths_hepB <dbl> 272000, 20000, 218000, 32000, 41000, 518000\n$ deaths_hebC <dbl> 35000, 38000, 42000, 21000, 65000, 43000\n```\n\n\n:::\n:::\n\n\n\n\n# what kind of plot?\n\nNow I don't even know what this kind of chart is called, let alone how to make it with ggplot, so I asked claude.ai for some suggestions. \n\n![](claude.png)\n\n# claude's code\n\nI was surprised that the [code that claude](https://github.com/jenrichmond/jenrichmond.github.io/blob/main/charts/2025-04-24_who/claudes_code.R) wrote ran without throwing an error and made a passable treemap plot. It is actually impressive that the LLM pulled the data and colour palette from the png file I gave it. Of course, if I want to learn about how treemaps work, I should probably start from scratch. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(here::here(\"charts\", \"2025-04-24_who\", \"claudes_code.R\"))\n\nfinal_plot\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n\n# my code\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhep %>% \n  ggplot(aes(area = new_hepB, fill = WHO_region)) +\n  geom_treemap()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\nBasic plot check! Things I would like to change...\n\n- colour scheme\n- labels on the boxes\n- titles, captions\n- layout (how do I get the large African Region box to appear on the top, rather than left)\n\n\n\n### colours\n\nIt is interesting that the colours that claude used in his code are close but not exactly the same as the ones I pulled from the plot using the ColorZilla tool. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclaudes_colors <- c(\n  \"African Region\" = \"#5EB3D5\", \"South-East Asia Region\" = \"#A9D18E\",\n  \"Eastern Mediterranean Region\" = \"#F6B18F\", \"Western Pacific Region\" = \"#FFD966\",\n  \"European Region\" = \"#C293CE\", \"Region of the Americas\" = \"#A593C7\"\n)\n\npalette <- c(\"African Region\" =\"#69C1E6\",  \"South-East Asia Region\" = \"#B5D47C\", \n                 \"Eastern Mediterranean Region\" = \"#F3A078\",  \n               \"Western Pacific Region\" =  \"#FACF70\",\n                 \"European Region\" =\"#CC71B2\", \"Region of the Americas\" =\"#A687B6\")\n```\n:::\n\n\n\n\nOK here I have sorted the colour palette and added I fine white line between the boxes using colour = \"white\". Next labels...\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhep %>% \n  ggplot(aes(area = new_hepB, fill = WHO_region)) +\n  geom_treemap(colour = \"white\") +\n  scale_fill_manual(values = palette)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n\n### labels\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhep %>% \n  ggplot(aes(area = new_hepB, fill = WHO_region, \n             label = paste(WHO_region, new_hepB, sep = \"\\n\"))) +\n  geom_treemap(colour = \"white\") +\n  scale_fill_manual(values = palette) +\n  geom_treemap_text(colour = \"black\",\n                    place = \"topleft\",\n                    size = 5, \n                    grow = FALSE) + # option from ggfittext to NOT make font fit box\n  easy_remove_legend()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\n\n### layout\n\n> note it doesn't seem possible to control the layout of the boxes using the `treemapify` package; I played with the layout argument which has \"squarified\" as the default but allows you to specific layout = \"srow\" which forces the tile placement to begin with a row... it didn't seem to do anything. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhep %>% \n  ggplot(aes(area = new_hepB, fill = WHO_region, layout = \"srow\",\n             label = paste(WHO_region, new_hepB, sep = \"\\n\"))) +\n  geom_treemap(colour = \"white\") +\n  scale_fill_manual(values = palette) +\n  geom_treemap_text(colour = \"black\",\n                    place = \"topleft\",\n                    size = 5, \n                    grow = FALSE) + # option from ggfittext to NOT make font fit box\n  easy_remove_legend()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n### titles / captions\n\nI am going to make an equivalent HepC plot and then paste them together before adding chart titles and captions. Using the layout = \"fixed\" option allow a side by side comparison of the HepB and HepC plots\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhepB <- hep %>% \n  ggplot(aes(area = new_hepB, fill = WHO_region, layout = \"fixed\",\n             label = paste(WHO_region, new_hepB, sep = \"\\n\"))) +\n  geom_treemap(colour = \"white\") +\n  scale_fill_manual(values = palette) +\n  geom_treemap_text(colour = \"black\",\n                    place = \"topleft\",\n                    size = 5, \n                    grow = FALSE) + # option from ggfittext to NOT make font fit box\n  easy_remove_legend() +\n  labs(title = \"Figure 2.4 Number of new hepatitis B and hepatitis C infections, by WHO region, 2022\", subtitle = \"Hepatitis B\") +\n  theme(plot.subtitle = element_text(hjust = 0.5, size = 5), \n        plot.title = element_text(size = 10)) \n\n\n\n hepC <- hep %>% \n  ggplot(aes(area = new_hepC, fill = WHO_region, layout = \"fixed\",\n             label = paste(WHO_region, new_hepC, sep = \"\\n\"))) +\n  geom_treemap(colour = \"white\") +\n  scale_fill_manual(values = palette) +\n  geom_treemap_text(colour = \"black\",\n                    place = \"topleft\",\n                    size = 5, \n                    grow = FALSE) + # option from ggfittext to NOT make font fit box\n  easy_remove_legend() +\n  labs(subtitle = \"Hepatitis C\") +\n   theme(plot.subtitle = element_text(hjust = 0.5, size = 5))\n\n \n hepB  + hepC \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\n\nAnd lastly, claude helped get the yellow/bold formatting for the title. The `ggtext` package is required to allow for element_markdown()\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhepB <- hep %>% \n  ggplot(aes(area = new_hepB, fill = WHO_region, layout = \"fixed\",\n             label = paste(WHO_region, new_hepB, sep = \"\\n\"))) +\n  geom_treemap(colour = \"white\") +\n  scale_fill_manual(values = palette) +\n  geom_treemap_text(colour = \"black\",\n                    place = \"topleft\",\n                    size = 5, \n                    grow = FALSE) + # option from ggfittext to NOT make font fit box\n  easy_remove_legend() +\nlabs(title = \"<span style='color:#F4BD4B;'>Figure 2.4</span><span> Number of new hepatitis B and hepatitis C infections, by WHO region, 2022</span>\", \n     subtitle = \"Hepatitis B\") +\n  theme(plot.subtitle = element_text(hjust = 0.5, size = 5), \n        plot.title = element_markdown(hjust = 0, size = 8, face = \"bold\"))\n\n hepC <- hep %>% \n  ggplot(aes(area = new_hepC, fill = WHO_region, layout = \"fixed\",\n             label = paste(WHO_region, new_hepC, sep = \"\\n\"))) +\n  geom_treemap(colour = \"white\") +\n  scale_fill_manual(values = palette) +\n  geom_treemap_text(colour = \"black\",\n                    place = \"topleft\",\n                    size = 5, \n                    grow = FALSE) + # option from ggfittext to NOT make font fit box\n  easy_remove_legend() +\n  labs(subtitle = \"Hepatitis C\") +\n   theme(plot.subtitle = element_text(hjust = 0.5, size = 5))\n\n \n hepB  + hepC \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}