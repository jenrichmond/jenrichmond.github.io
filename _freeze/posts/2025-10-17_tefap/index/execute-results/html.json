{
  "hash": "b3734f4fefd2cfa02af510d5fffd9434",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"TEFAP order cancellations\"\nformat: html\nauthor: Jen Richmond\ndate: 2025-10-17\ncode-fold: show\n---\n\nOn BlueSky this afternoon I came across some data that [ProPublica were sharing on github](https://github.com/propublica/tefap-data) about cancelled food orders funded by The Emergency Food Assistance Program (TEFAP). TEFAP is a USDA program that funds the distribution healthy food (meat, eggs, dairy, fruit/vege) from US suppliers to food banks, who pass it along to vulnerable people in communities across the country. Propublica had made a Freedom of Information Act (FOIA) request to USDA about cancelled food orders and written up this [nice scrollytelling piece](https://projects.propublica.org/trump-food-cuts/) about the 94 million pounds of food orders that have been cancelled since June by the Trump administration.\n\n> \"In all, the USDA records indicate that food banks were expecting more than 27 million pounds of chicken, 2 million gallons of milk, 10 million pounds of dried fruit and 67 million eggs that never arrived.\"\n\nThis is the kind of data that TidyTuesday peeps might have fun with so I decided to dig into it to see whether I could visualise something interesting. \n\n\n## read the data \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(gt)\nlibrary(usmap)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntefap <- read_csv(\"https://raw.githubusercontent.com/propublica/tefap-data/refs/heads/main/CCC%20FOIA%20Request%207.29.25.csv\") %>%\n  clean_names() %>%\n  mutate(requested_del_date = mdy(requested_del_date), date_received = mdy(date_received)) %>%\n    rename(postal = sold_to_state, order_status = status_text)\n\n\nglimpse(tefap)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 5,359\nColumns: 10\n$ material           <dbl> 100242, 100242, 100242, 100242, 100242, 100242, 100…\n$ material_desc      <chr> \"BLUEBERRY WILD FRZ CTN-8/3 LB\", \"BLUEBERRY WILD FR…\n$ requested_qty      <dbl> 960, 480, 800, 640, 848, 300, 292, 308, 857, 275, 1…\n$ sales_unit         <chr> \"CS\", \"CS\", \"CS\", \"CS\", \"CS\", \"CS\", \"CS\", \"CS\", \"CS…\n$ order_status       <chr> \"Order Received\", \"Order Received\", \"Order Received…\n$ requested_del_date <date> 2025-05-15, 2025-05-15, 2025-05-15, 2025-05-15, 20…\n$ date_received      <date> 2025-05-07, 2025-05-08, 2025-05-07, 2025-05-07, 20…\n$ postal             <chr> \"AL\", \"AL\", \"AL\", \"AL\", \"AR\", \"AR\", \"AR\", \"AR\", \"AR…\n$ sold_to_name       <chr> \"AL Dept. of Education\", \"AL Dept. of Education\", \"…\n$ ship_to_name       <chr> \"Heart of Alabama Food Bank\", \"Feeding The Gulf Coa…\n```\n\n\n:::\n:::\n\n\n## when were the orders cancelled? \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntefap <- tefap %>%\n  mutate(year = year(requested_del_date), \n        month = month(requested_del_date)) %>%\n  filter(year == 2025) \n\n\nbymonth <- tefap %>%\n  group_by(month, order_status)  %>%\n  summarise(orders = n())  %>%\n  ungroup()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'month'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n:::\n\n\n\n### plot \n\nThis plot has me wondering how complete this data is. There were a crazy number of cancelled orders in June and July but it is hard to make sense of whether those values are a problem without having a good idea of the total number of orders that are typically funded by this program and what proportion of those have been cancelled. It is strange that the orders received values are really low and flat across the early part of the year. I wonder whether the FOIA request only asked about cancelled orders. \n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nbymonth %>%\n  \n  ggplot(aes(x = month, y = orders, colour = order_status)) +\n  geom_point(size = 3) +\n  geom_line() +\n  labs(x = \"Month\", y = \"Number of orders\", \n       title = \"Orders funded by The Emergency Food Assistance \\nProgram CCC 2025 \", \n       caption = \"Data FOIA to USDA made by Propublica \\nhttps://github.com/propublica/tefap-data\") +\nscale_y_continuous(limits = c(0,2000)) +\n  scale_x_continuous(\n    breaks = 1:12,\n    labels = month.abb  # or month.name for full names\n  ) +\n  theme_bw() \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code  code-fold=\"true\"}\nggsave(here::here(\"posts\", \"2025-10-17_tefap\", \"featured.png\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nSaving 7 x 5 in image\n```\n\n\n:::\n:::\n\n\n\n\n## where were the orders cancelled\n\nHere I am interested in mapping where the orders were cancelled. If I just plot cancelled orders, the states with the highest population pop out, so I need to do a bit of wrangling to get state level population data joined to the dataframe to allow me to correct for state population\n\nHere I an counting the number of orders cancelled by state, then running a separate script that pastes state population data from wikipedia and joins it to my dataframe, before calculating how many orders per million population there are for each state. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_cancelled_orders <- tefap %>%\n  filter(order_status == \"Canceled\") %>%\n  group_by(postal) %>%\n  summarise(orders_cancelled = n()) %>%\n  ungroup()\n\nsource(here::here(\"posts\", \"2025-10-17_tefap\", \"datapasta US state population wikipedia.R\"))\n\njoined_cancel <- left_join(state_cancelled_orders, state_abbrev_pop, by = \"postal\") %>%\n  mutate(millions = pop/1000000, \n         orders_per_million = orders_cancelled/millions)\n```\n:::\n\n\n\n\nWhen represented as the number of orders cancelled per million population, it is clear that red states are being adversely affected by this funding cut. \n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nplot_usmap(data = joined_cancel, values = \"orders_per_million\", labels=TRUE) +\n  scale_fill_continuous(low = \"white\", high = \"red\") \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}