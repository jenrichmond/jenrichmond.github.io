{
  "hash": "f55b7dc8fe365b50d915c1fe62d95e51",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"vesuvius\"\neditor: visual\nauthor: Jen Richmond\ndate: 2025-05-13\n---\n\n\n\nThe TidyTuesday dataset this week is about seismic activity at Mt Vesuvius. Given we are talking about a volcano, I am expecting that there might be cyclical patterns in this data i.e. the volcano is active for a few months and then quietens down and then is active again.\n\n![Mt Vesuvius (image source: Wikipedia)](vesuvius.jpg)\n\nDuring the #30DayChart challenge I learned how to use `geom_tile()` to make a [\"show us your stripes\" plot](https://jenrichmond.github.io/charts/2025-04-11_stripes/) illustrating climate-related changes in temperature. Here I am testing whether a striped plot might be a good way to capture changes in seismic activity over time.\n\n### read the data\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(tidyverse)\nlibrary(showtext)\nlibrary(here)\nlibrary(janitor)\nlibrary(RColorBrewer)\nlibrary(ggeasy)\nlibrary(patchwork)\nlibrary(ggpubr)\nlibrary(ggtext)\n\noptions(scipen = 999)\n\ntuesdata <- tidytuesdayR::tt_load(2025, week = 19)\n\nv <- tuesdata$vesuvius\n\nv <- v %>%\n  mutate(month = month(time, label = TRUE))\n\nglimpse(v)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 12,027\nColumns: 12\n$ event_id              <dbl> 4251, 4252, 22547, 22546, 22545, 22544, 22543, 2…\n$ time                  <dttm> 2011-04-20 00:27:24, 2012-06-19 21:29:48, 2013-…\n$ latitude              <dbl> 40.81800, 40.80883, 40.82217, NA, NA, NA, NA, NA…\n$ longitude             <dbl> 14.43000, 14.42717, 14.42800, NA, NA, NA, NA, NA…\n$ depth_km              <dbl> 0.42, 1.31, 0.06, NA, NA, NA, NA, NA, NA, NA, NA…\n$ duration_magnitude_md <dbl> 1.2, 0.7, 2.2, 0.2, 0.2, 0.0, 0.8, 1.4, -0.2, 0.…\n$ md_error              <dbl> 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3…\n$ area                  <chr> \"Mount Vesuvius\", \"Mount Vesuvius\", \"Mount Vesuv…\n$ type                  <chr> \"earthquake\", \"earthquake\", \"earthquake\", \"earth…\n$ review_level          <chr> \"revised\", \"revised\", \"preliminary\", \"preliminar…\n$ year                  <dbl> 2011, 2012, 2013, 2013, 2013, 2013, 2013, 2013, …\n$ month                 <ord> Apr, Jun, Jan, Jan, Jan, Jan, Jan, Jan, Jan, Jan…\n```\n\n\n:::\n:::\n\n\n\n### create stripe theme\n\nThis theme is adapted from [Dominic Roye's blog](https://dominicroye.github.io/blog/how-to-create-warming-stripes-in-r/index.html). It uses theme_minimal as a base and then gets rid of the y axis axis and labels, gridlines, legend title, adds some space to the x axis labels, makes the legend slightly narrower than default, adds a coloured background, more space around the plot and changes the titlefont.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nfont_add_google(\"Lato\", \"lato\")\nshowtext_auto()\n\ntheme_stripe <- function(title_family = \"lato\") { \n  \n  theme_minimal() %+replace%\n    theme(\n      axis.text.y = element_blank(),\n      axis.line.y = element_blank(),\n      axis.title = element_blank(),\n      panel.grid.major = element_blank(),\n      legend.title = element_blank(),\n      axis.text.x = element_text(vjust = 3),\n      panel.grid.minor = element_blank(),\n      legend.key.width = unit(0.5, \"lines\"), \n      plot.caption = element_textbox_simple(), # helps with social caption html\n      panel.background = element_rect(fill = \"papayawhip\", color = NA),\n      plot.background = element_rect(fill = \"papayawhip\", color = NA),\n      plot.margin = margin(t = 20, r = 20, b = 20, l = 20, unit = \"pt\"), \n      plot.title = element_text(\n        family = title_family,\n        size = 14,\n        hjust = 0, \n        color = \"black\"\n      )\n    )\n}\n\n# specific theme for patchwork plot, less white space\n\ntheme_stripe_pw <- function(title_family = \"lato\") { \n  \n  theme_minimal() %+replace%\n    theme(\n      axis.text.y = element_blank(),\n      axis.line.y = element_blank(),\n      axis.title = element_blank(),\n      panel.grid.major = element_blank(),\n      legend.title = element_blank(),\n      axis.text.x = element_text(vjust = 3),\n      panel.grid.minor = element_blank(),\n      legend.key.width = unit(0.5, \"lines\"), \n        plot.caption = element_textbox_simple(), # helps with social caption html\n      panel.background = element_rect(fill = \"papayawhip\", color = NA),\n      plot.background = element_rect(fill = \"papayawhip\", color = NA),\n      plot.margin = margin(t = 20, r = 10, b = 10, l = 10, unit = \"pt\"), \n      plot.title = element_text(\n        family = title_family,\n        size = 14,\n        hjust = 0, \n        color = \"black\"\n      )\n    )\n}\n\n\ncol_stripe <- brewer.pal(9, \"YlOrRd\")\n```\n:::\n\n\n\n# How many seismic events are recorded at Mt Vesuvius?\n\n### per year\n\nLets start with counting how many seismic events happen at Vesuvius each year. Most of the data was measured between 2013 and 2024, but there were a couple of events relating to 2011/2012 readings, so I am filtering those out.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# count events per year\nevents_year <- v %>%\n  group_by(year) %>%\n  summarise(count = n()) %>%\n  filter(year >=2013)\n\n# get mean and range for use in gradient\n\nyear_maxmin <- range(events_year$count, na.rm = T)\nyear_md <- mean(events_year$count, na.rm = T)\n\n# plot \nevents_year %>%\n    ggplot(aes(x = year, y = 1, fill = count)) +\n  geom_tile() +\n  scale_x_continuous(breaks = seq(2014, 2024, 2)) +\n  scale_fill_gradientn(colors = col_stripe, \n                       values = scales::rescale(c(year_maxmin[1], year_md, year_maxmin[2])), \n                       na.value = \"gray80\", \n                         breaks = seq(0, 1500, 250),\n                      limits = c(0, 1500)) + \n  theme_stripe()  +\n  labs(title = \"Number of seismic events per year at Vesuvius\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\nYikes! Looks like 2024 was a particularly active year for Vesuvius, with 1315 events recorded.\n\n### per month\n\nWhat would that look like if we counted the number of events per month and plotted that as a stripe plot?\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nevents_month <- v %>%\n  group_by(year, month) %>%\n  summarise(count = n()) %>%\n  unite(year_month, c(year, month), sep = \"_\", remove = FALSE) %>%\n  arrange(year, month) %>%\n  filter(year >= 2013) %>%\n  ungroup()\n\n\nmonth_maxmin <- range(events_month$count, na.rm = T)\nmonth_md <- mean(events_month$count, na.rm = T)\n\njan_each_year <- events_month %>% \n              filter(str_detect(year_month, \"_Jan$\")) %>% \n              pull(year_month)\n\njust_year <- events_month %>% \n              filter(str_detect(year_month, \"_Jan$\")) %>% \n              pull(year_month) %>% \n              str_sub(1, 4)\n\n\nevents_month %>%\n    ggplot(aes(x = year_month, y = 1, fill = count)) +\n  geom_tile() +\n  scale_fill_gradientn(colors = col_stripe, \n                       values = scales::rescale(c(month_maxmin[1], month_md, month_maxmin[2])), \n                       na.value = \"gray80\", \n                        breaks = seq(0, 250, 50),\n                      limits = c(0, 250)) + \n  scale_x_discrete(breaks = jan_each_year, labels = just_year) +\n  theme_stripe() +\n  labs(title = \"Number of seismic events recorded per month at Vesuvius\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\nPlotted by month, 2024 still looks like it had quite high activity, but not as high as periods in 2018 and 2019. In March 2019, there were 247 events recorded.\n\n# How big are the seismic events at Mt Vesuvius?\n\nThe duration_magnitude_md variable captures the duration magnitude (Md) of each event, which is an index of the amount of energy released.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nmag_month <- v %>%\n  group_by(year, month) %>%\n  summarise(mean = mean(duration_magnitude_md, na.rm = TRUE)) %>%\n  unite(year_month, c(year, month), sep = \"_\", remove = FALSE) %>%\n  arrange(year, month) %>%\n  filter(year >= 2013) %>%\n  ungroup()\n\n\nmag_maxmin <- range(mag_month$mean, na.rm = T)\nmag_md <- mean(mag_month$mean, na.rm = T)\n\nmag_month %>%\n    ggplot(aes(x = year_month, y = 1, fill = mean)) +\n  geom_tile() +\n  scale_fill_gradientn(colors = col_stripe, \n                       values = scales::rescale(c(mag_maxmin[1], mag_md, mag_maxmin[2])), \n                       na.value = \"gray80\", \n                        breaks = seq(-0.3, 0.5, 0.1),\n                      limits = c(-0.3, 0.5), \n                      labels = scales::label_number(accuracy = 0.1)) +\n  theme_stripe() +\n  labs(title = \"Mean duration magnitude of seismic events per month at Vesuvius\") +\n    scale_x_discrete(breaks = jan_each_year, labels = just_year)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n# Is the number of events related to the duration magnitude?\n\nOk this is kinda cool- I know nothing about how volcanos work, but if we line up these two plots using the `patchwork` package, it looks a bit like months that have LOTS of events tend to have smaller mean duration magnitude, whereas months that have fewer events, tend to have larger duration magnitudes.\n\nI guess it makes sense that the volcano is releasing pressure, either via many small events, or by fewer larger events.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ncount / mag +\n  plot_annotation(title = \"The frequency and magnitude of seismic events at Mt Vesuvius\",\n                  subtitle = \"Pressure is released either in many small events or fewer larger events\",\n                  caption = \"Data from Italian Istituto Nazionale di Geofisica e Vulcanologia (INGV)\",\n                  theme = theme_stripe_pw())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n\nHere I am combining the summarising I did above to get the count of events and mean duration magnitude in the same dataframe and switching to the `ggpubr::ggscatter` to make it easy to add correlation coefficients to the plot.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nmag_count <- v %>%\n  group_by(year, month) %>%\n  summarise(count = n(), mean_mag = mean(duration_magnitude_md, na.rm = TRUE)) %>%\n  unite(year_month, c(year, month), sep = \"_\", remove = FALSE) %>%\n  arrange(year, month) %>%\n  filter(year >= 2013) %>%\n  ungroup()\n\nmag_count %>%\n  ggscatter(x = \"count\", y = \"mean_mag\",\n   add = \"reg.line\",  # Add regressin line\n   add.params = list(color = \"blue\", fill = \"lightgray\"), # Customize reg. line\n   conf.int = TRUE, # Add confidence interval\n   cor.coef = TRUE, # Add correlation coefficient. see ?stat_cor\n   cor.coeff.args = list(method = \"pearson\", label.x = 150, label.sep = \"\\n\"), \n   title = \"At Mt Vesuvius, months with more seismic activity tend to \\nhave, on average, smaller events\", \n   caption = \"Data from Italian Istituto Nazionale di \\nGeofisica e Vulcanologia (INGV); 2013-2024\",\n   xlab = \"Number of seismic events per month\", \n   ylab = \"Mean monthly duration magnitude\"\n   )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}